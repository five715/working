<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<title>我的年度表情</title>
<link rel="stylesheet" href="css/VogsoStyle-1.0.0.css">
<link rel="stylesheet" href="css/style.css">
<script src="js/libs/jquery-3.2.1.min.js"></script>
<script src="js/libs/easeljs.js"></script>
<script src="js/libs/preloadjs.min.js"></script>
<script src="js/data.js"></script>
<script src="js/common.js"></script>
<script src="js/Poster.class.js"></script>
<script src="js/libs/Vogsojs-1.0.0.js"></script>
</head>
<body>
<audio src="sounds/sound_1.mp3" loop preload class="sound3"></audio>
<div class="box">
	<!--弹窗-->
	<div class="popup">
		<div class="popup_poster pop">
			<div class="poster">
				<img src="images/popup_poster_pic.jpg"/>
			</div>
			<div class="hint">
				<img src="images/popup_poster_hint.png"/>
			</div>
		</div>
	</div>
	<!--loading-->
	<div class="loading">
		<img src="images/loading_bg.jpg"/>
		<div class="ioc"></div>
		<div class="plan">
			<div class="overflow">
				<div class="hidden">
					<img src="images/loading_plan.png" />
				</div>
			</div>
			<div class="plan_box">
				<img src="images/loading_plan_bg.png" />
			</div>
		</div>
		<div class="per">50%</div>
	</div>
	<!--首页-->
	<div class="index">
		<img src="images/index_bg.jpg"/>
		<div class="boxes">
			<img src="images/index_box_bg.png"/>
			<div class="tit">
				<img src="images/index_boxes_tit_31.png" class="alter"/>
			</div>
			<div class="pic">
				<img src="images/index_boxes_pic_31.png" class="alter"/>
			</div>
			<div class="left">
				<img src="images/index_boxes_left_31.png" class="alter"/>
			</div>
			<div class="right">
				<img src="images/index_boxes_right_31.png" class="alter"/>
			</div>
			<div class="yi">
				<img src="images/index_boxes_yi_1.png" class="alter"/>
			</div>
			<div class="ji">
				<img src="images/index_boxes_ji_1.png" class="alter"/>
			</div>
		</div>
		<div class="btn">
			<img src="images/index_btn.png"/>
		</div>
		<div class="logo">
			<img src="images/logo.png"/>
		</div>
		<video src="videos/index.mp4" playsinline webkit-playsinline preload class="video"></video>
	</div>
	<!--答题-->
	<div class="answer">
		<img src="images/loading_bg.jpg"/>
		<div class="plan">
			<div class="overflow">
				<div class="hidden">
					<img src="images/loading_plan.png" />
				</div>
			</div>
			<div class="plan_box">
				<img src="images/loading_plan_bg.png" />
			</div>
		</div>
		<div class="per">10s</div>
		<div class="issue">
			<p>下列人设识别中，你属于</p>
		</div>
		<div class="ans">
			<div class="gif_bg">
				<img src="images/iusse_gif_bg_6.png"/>
			</div>
			<div class="gif"></div>
			<div class="choices">
				<div class="choice choice_1" data-n="1"><img src="images/choice_1_1.jpg" alt="" /></div>
				<div class="choice choice_2" data-n="2"><img src="images/choice_1_2.jpg" alt="" /></div>
				<div class="choice choice_3" data-n="3"><img src="images/choice_1_3.jpg" alt="" /></div>
				<div class="choice choice_4" data-n="4"><img src="images/choice_1_4.jpg" alt="" /></div>
				<div class="choice choice_5" data-n="5"><img src="images/choice_1_5.jpg" alt="" /></div>
				<div class="choice choice_6" data-n="6"><img src="images/choice_1_6.jpg" alt="" /></div>
			</div>
		</div>
		<div class="play">
			<img src="images/ioc_play.png"/>
		</div>
	</div>
	<!--结果-->
	<div class="result">
		<img src="images/index_bg.jpg"/>
		<div class="title">
			<img src="images/result_title.png"/>
		</div>
		<div class="emoji">
			<img src="images/result_emoji_10.jpg"/>
		</div>
		<div class="seal">
			<img src="res/seal.png"/>
		</div>
		<div class="text">
			<p>你是一个没有感情的酒精容器</p>
		</div>
		<div class="btn_not_me">
			<img src="images/result_not_me.png"/>
		</div>
		<div class="btn_friend">
			<img src="images/result_friend.png"/>
		</div>
		<canvas id="poster" width="579" height="882"></canvas>
	</div>
</div>
</body>
<script type="text/javascript" charset="utf-8" src="//mat1.gtimg.com/news/yuanwt/jquery-1.11.3.min.js"></script>
<script type="text/javascript" charset="utf-8" src="//mat1.gtimg.com/news/yuanwt/jquery.touch.min.js"></script>
<script type="text/javascript" src="//mat1.gtimg.com/news/zt2017/recordsound/qrcode.js"></script>
<script type="text/javascript" charset="utf-8" src="//mat1.gtimg.com/news/zt2018/jjhjh5/createImg.js"></script>
<script type="text/javascript" charset="utf-8" src="//mat1.gtimg.com/news/zt2018/jjhjh5/data.js"></script>
<script type="text/javascript"> 
	var UA = function() {
 	var a = navigator.userAgent.toLowerCase();
 	return {
 		ipad: /ipad/.test(a),
 		iphone: /iphone/.test(a),
 		android: /android/.test(a),
 		qqnews: /qqnews/.test(a),
 		weixin: /micromessenger/.test(a),
 		qqnews_version: a.match(/qqnews/i) == "qqnews" ? a.split('qqnews/')[1] : ''
 	}
 };

 function shareQQNews() {
 	var a = UA();
 	switch(true) {
 		case a.qqnews:
 			if(window.TencentNews && window.TencentNews.setShareArticleInfo) {
 				window.TencentNews.setShareArticleInfo(shareData.title, shareData.desc, shareData.desc, shareData.link, shareData.img)
 			}
 			if(window.TencentNews && window.TencentNews.showShareMenu) {
 				window.TencentNews.showShareMenu(shareData.link, shareData.title, shareData.desc, shareData.img, "news_news_wc")
 			} else {
 				window.TencentNews.shareFromWebView(shareData.title, shareData.desc, shareData.img)
 			}
 			break;
 		case a.weixin:
 			var b = document.querySelector(".weixin_layout");
 			b.style.display = "block";
 			b.addEventListener("click", function() {
 				b.style.display = "none"
 			});
 			break;
 		default:
 			window.location = "http://share.v.t.qq.com/index.php?c=share&a=index&appkey=801378464&url=" + shareData.link + "&title=" + shareData.desc + "&pic=" + shareData.img + "&des=" + shareData.title;
 			break
 	}
 };

 function onBridgeReady() {
 	WeixinJSBridge.on("menu:share:timeline", function(e) {
 		var b = {
 			img_width: "120",
 			img_height: "120",
 			img_url: shareData.img,
 			link: shareData.link,
 			desc: shareData.desc,
 			title: shareData.title
 		};
 		WeixinJSBridge.invoke("shareTimeline", b, function(a) {
 			WeixinJSBridge.log(a.err_msg)
 		})
 	});
 	WeixinJSBridge.on("menu:share:weibo", function() {
 		WeixinJSBridge.invoke("shareWeibo", {
 			"content": shareData.desc,
 			"url": shareData.link
 		}, function(a) {
 			WeixinJSBridge.log(a.err_msg)
 		})
 	});
 	WeixinJSBridge.on('menu:share:appmessage', function(b) {
 		WeixinJSBridge.invoke("sendAppMessage", {
 			img_width: "120",
 			img_height: "120",
 			img_url: shareData.img,
 			link: shareData.link,
 			desc: shareData.desc,
 			title: shareData.title
 		}, function(a) {
 			WeixinJSBridge.log(a.err_msg)
 		})
 	})
 };
 document.addEventListener('WeixinJSBridgeReady', function() {
 	onBridgeReady()
 });

 function androidQQNewsShare() {
 	var a = document.getElementsByTagName('body')[0];
 	var b = document.createElement('script');
 	b.type = 'text/javascript';
 	b.src = '//mat1.gtimg.com/www/js/newsapp/jsapi/news.js?_tsid=1';
 	a.appendChild(b)
 }
 androidQQNewsShare();
 var nickname = '我的';
 var headimgurl = '//news.qq.com/zt2018/jjhjh5/photo.jpg';
 if(UA().weixin) {
 	function getUserInfo() {
 		$.ajax({
 			url: 'https://yc.static.qq.com/?service=App.Getinfo_Getinfo.getindex',
 			dataType: 'jsonp',
 			jsonp: "callback",
 			jsonpCallback: "infocallback",
 			success: function(data) {
 				infocallback(data)
 			}
 		})
 	}

 	function getwxUsrInfo() {
 		var g_appid = "wxca92e8bcb9f28c93";
 		var authserver = "https://yc.static.qq.com/?service=App.Getinfo_Getinfo.Getuserinfo&original_uri=" + encodeURIComponent(location.href);
 		var url = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=' + g_appid + '&redirect_uri=' + encodeURIComponent(authserver) + '&response_type=code&scope=snsapi_userinfo&state=' + encodeURIComponent(location.href) + '#wechat_redirect';
 		document.location.href = url
 	}

 	function infocallback(e) {
 		if(e.data.openid == null) {
 			getwxUsrInfo()
 		} else {
 			nickname = e.data.nickname;
 			headimgurl = e.data.headimgurl
 		}
 	}
 	getUserInfo()
 } else {
 	$.get('//imgcache.qq.com/tencentvideo_v1/tvp/js/module/tvp.login.js', function() {
 		txvLogin.isQQLogin(function(isqqlogin) {
 			if(isqqlogin) {
 				txvLogin.requestQQInfo(function(user_data) {
 					nickname = user_data.nick;
 					headimgurl = user_data.qqface
 				})
 			} else {
 				txvLogin.openQQLogin()
 			}
 		})
 	})
 };

 function eventDefaults(ev) {
 	ev.preventDefault()
 };
 document.addEventListener('touchmove', eventDefaults, false);
 var people = {
 	_w: document.documentElement.clientWidth,
 	_h: document.documentElement.clientHeight,
 	p1Num: 0,
 	p2Num: 0,
 	p3Num: 0,
 	p4Num: 0,
 	p5Num: 0,
 	p6Num: 0,
 	p7Num: 0,
 	p8Num: 0,
 	p9Num: 0,
 	questNum: 0,
 	flag: true,
 	resultData: [],
 	threePeople: [],
 	resultNum: 0,
 	classTimer: null,
 	classNum: 0,
 	wordNum: 0,
 	loadImgData: ['//mat1.gtimg.com/news/zt2018/jjhjh5/body-bg.jpg', '//mat1.gtimg.com/news/zt2018/jjhjh5/cover-left.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/cover-right.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/cover-title.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/fenxipic.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/people-bg.jpg', '//mat1.gtimg.com/news/zt2018/jjhjh5/q-active.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/q-default.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/qicon-01.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/qicon-02.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/qicon-03.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/qicon-04.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/qicon-05.png', '//mat1.gtimg.com/news/zt2018/jjhjh5/qicon-06.png'],
 	init: function() {
 		this.loadImages(this.loadImgData);
 		this.active()
 	},
 	getHeight: function(scale, bl) {
 		return this._w * bl / scale
 	},
 	loadImages: function(picArr, fn, callback) {
 		var index = 0;
 		var arr = [];
 		var len = picArr.length;

 		function loads() {
 			var img = new Image();
 			img.onload = function() {
 				arr.push(img);
 				if(index <
 					len) {
 					loads();
 					fn && fn(index, len)
 				} else {
 					arr.shift();
 					callback && callback(arr)
 				}
 				index++
 			};
 			img.src = picArr[index]
 		}
 		if(len > 0) {
 			loads()
 		}
 	},
 	toCoverPage: function() {
 		$(".cover").show();
 		$(".loading").fadeOut(400);
 		$(".cover-left").addClass('fadeInLeft');
 		$(".cover-right").addClass('fadeInRight')
 	},
 	createHTML: function() {
 		$(".question").show();
 		$(".cover").fadeOut(400);
 		var h = '';
 		for(var i = 0; i <
 			questData.length; i++) {
 			var li = '';
 			for(var j = 0; j < questData[i].answerList.length; j++) {
 				var p = '';
 				for(var m = 0; m < questData[i].answerList[j].data.length; m++) {
 					p += (questData[i].answerList[j].data[m].score + ',')
 				}
 				li += '<li people="' + p + '"><span class="l-c-' + j + '"></span><p>' + questData[i].answerList[j].list + '</p></li>'
 			}
 			h += '<div class="abs-rlt question-all"><div class="quest-main"><div class="quest-box"><div class="progress"><img class="pro-now" src="//mat1.gtimg.com/news/zt2018/jjhjh5/' + (i + 1) + '.png"><img src="//mat1.gtimg.com/news/zt2018/jjhjh5/xiegang.png" style="width:5px;"><img class="pro-total" src="//mat1.gtimg.com/news/zt2018/jjhjh5/' + questData.length + '.png"></div><div class="quest-content quest-bg' + i + '"><p>' + questData[i].title + '</p></div></div></div><div class="answer-main"><ul class="answer-list">' + li + '</ul></div></div>'
 		}
 		$(".question-main").html(h).css({
 			'width': this._w * questData.length
 		});
 		$(".question-all").css({
 			'width': this._w
 		});
 		$(".quest-box").css({
 			'height': this.getHeight(750 / 600, 1)
 		});
 		$(".quest-content").css({
 			'width': this._w * 0.83,
 			'height': this.getHeight(750 / 600, 0.83)
 		})
 	},
 	jsonCompare: function(property) {
 		return function(a, b) {
 			var value1 = a[property];
 			var value2 = b[property];
 			return value2 - value1
 		}
 	},
 	resultPage: function() {
 		var _this = this;
 		$(".result-page").show();
 		$(".wait").fadeOut(400);
 		$(".word-list").css({
 			'width': this._w * 0.88 * $(".word-list li").length + 10 * $(".word-list li").length
 		});
 		$(".word-list li").css({
 			'width': this._w * 0.88,
 			'height': this.getHeight(650 / 527, 0.88)
 		});
 		var resultJson = this.resultData.sort(this.jsonCompare("score"));
 		this.threePeople = resultJson.slice(0, 3);
 		console.log(this.threePeople);
 		for(var i = 0; i < this.threePeople.length; i++) {
 			this.resultNum += parseInt(this.threePeople[i].score)
 		}
 		for(var m = 0; m < this.threePeople.length; m++) {
 			var w = parseInt(parseInt(this.threePeople[m].score) / this.resultNum * 100);
 			var keyword = this.threePeople[m].keyword.split(',');
 			$(".pp-main span").eq(m).css({
 				'width': w + '%'
 			}).html(w + '%');
 			$(".name-main span").eq(m).html(this.threePeople[m].names);
 			$(".word-all").eq(m).find('p').html(this.threePeople[m].desc);
 			$(".word-all h3").eq(m).find('strong').attr("src", this.threePeople[m].music);
 			for(var j = 0; j < keyword.length; j++) {
 				$(".word-all h4").eq(m).find('span').eq(j).html(keyword[j])
 			}
 		}
 	},
 	waitPage: function() {
 		var _this = this;
 		$(".wait").show();
 		$(".question").fadeOut(400);
 		setTimeout(function() {
 			_this.resultPage()
 		}, 4000)
 	},
 	toQuestPage: function() {
 		var _this = this;
 		this.createHTML();
 		$(".answer-list").eq(this.questNum).find('li').each(function(m) {
 			$(this).enableTouch().on('tap', function() {
 				if(_this.flag) {
 					var aLi = $(".answer-list").eq(_this.questNum).find('li');
 					aLi.removeClass('active').eq(m).addClass('active');
 					var peopleData = aLi.eq(m).attr('people').split(',');
 					_this.p1Num += parseInt(peopleData[0]);
 					_this.p2Num += parseInt(peopleData[1]);
 					_this.p3Num += parseInt(peopleData[2]);
 					_this.p4Num += parseInt(peopleData[3]);
 					_this.p5Num += parseInt(peopleData[4]);
 					_this.p6Num += parseInt(peopleData[5]);
 					_this.p7Num += parseInt(peopleData[6]);
 					_this.p8Num += parseInt(peopleData[7]);
 					_this.p9Num += parseInt(peopleData[8]);
 					_this.resultData = [{
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p1.mp3",
 						score: _this.p1Num,
 						"keyword": "勇敢,率性,热爱生活",
 						"names": "前泽友作",
 						"shareword": "率性是你性格的底色，你做事如前泽友作一般特立独行。不按套路出牌的你似乎有些任性，其实你才是那个把生活爱到极致的人。",
 						desc: "日本排名14的富豪，2018年，他的一句“我要去月球了”让世界瞩目。作为首位绕月旅行私人乘客，2023年前泽友作将是继1972年美国阿波罗载人航空任务后，第一个重返月球的人类，勇气可叹。要知道，面对外太空，再不平凡的地球人也是无名之辈。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p2.mp3",
 						score: _this.p2Num,
 						"keyword": "行动派,执拗,敢作敢当",
 						"names": "朱振彪",
 						"shareword": "键盘侠盛行的当下，你是那个路见不平拔刀相助的行动派，有时甚至有些一根筋。就像朱振彪，善良是你的准则，正义是你的坚持，哪怕代价是被人误解的纠葛。",
 						desc: "唐山小伙朱振彪目睹了一起交通事故，肇事者将一人撞倒后逃逸。朱振彪追赶肇事者，对方不仅没有停止逃逸，反而故意往过路车辆上撞，意欲自杀，随后竟翻越围栏跑上铁路，最终被火车撞死。死者家属对朱振彪索赔60万。2018年，法院判定其不担责。朱振彪后获见义勇为确认书。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p3.mp3",
 						score: _this.p3Num,
 						"keyword": "喜感,幽默,乐观",
 						"names": "吴正强",
 						"shareword": "你和小吴的共同点是有娱乐精神，甚至用自黑的方式博大家一乐。关键时刻你能带给大家新的希望，生活再难也要记得微笑鸭。",
 						desc: "18岁男孩吴正强入职前理发，却被杭州某理发店的“免费项目”提发际线修鬓角收费4万元，气愤维权。意外因外形有趣被制成表情包一夜爆红，成了全国人民的快乐源泉“发际线小哥”。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p4.mp3",
 						score: _this.p4Num,
 						"keyword": "求生欲,执着,坦然",
 						"names": "李子璇",
 						"shareword": "像李子璇一般，你身上有强烈的求生欲，目标明确，做事执着。你的人生信条是努力就会有回报，你相信那些为梦想受过的伤，流过的泪在胜利之后，都将成为荣耀。",
 						desc: "2018年一款现象级偶像养成综艺《创造101》引爆话题，101个女孩中选拔11人组成女团出道。李子璇以第12名一名之差落选，一首自己作词的《12》唱足了无人知晓的遗憾。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p5.mp3",
 						score: _this.p5Num,
 						"keyword": "冲破桎梏,爽朗,自信",
 						"names": "朱芊佩",
 						"shareword": "你的倔强是没有应该怎样，你的强大是只听从内心，人生不设限是你的信条。就像港版罗拉，没有性别包袱，只要热爱，便不断战胜所在行业对于女性的所有轻视。",
 						desc: "因为几张运货时被路人偷拍的照片，香港美女搬运工朱芊佩在网上爆红，被网友们称作“港版罗拉”，然而她本人却没有露面回应。 2018年媒体采访曝光了朱芊佩的真身，采访中她依然无比专注，风风火火地推着货架大步快走的爽朗自信打动了很多人。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p6.mp3",
 						score: _this.p6Num,
 						"keyword": "较真,机智,坚持",
 						"names": "大学生李某",
 						"shareword": "你和告倒铁路局的李某一样，常被称作“杠精”，却是这个社会的稀有物种。你最不喜欢听所谓的枪打出头鸟，你相信行动才会有改变。不盲从、不鲁莽，理性维护自己的利益，坚持对错，分辨是非。",
 						desc: "一年前，大学生李某在普通列车上遭遇二手烟，随后将哈尔滨铁路局告上法庭。此案被称为“普通列车禁烟第一案”。一年后，2018 年6 月该案由北京铁路运输法院一审宣判：哈尔滨铁路局在列车上设置吸烟区属违法行为，要求列车取消吸烟区并拆除烟具。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p7.mp3",
 						score: _this.p7Num,
 						"keyword": "务实,勤勉,理性",
 						"names": "天津新政落户者",
 						"shareword": "你很喜欢一句话，世界上只有一种真正的英雄主义，便是认清生活真相之后依然热爱生活。对此，你很像天津新政落户者，务实、勤勉，不错过兼顾灵魂和肉体难题的任何机会，奋力生活。",
 						desc: "2018年全国上演 “人才争夺战”，各城市落户、购房、补贴政策力度之大前所未有。5月，天津推出“海河英才”行动计划，条件之宽松，堪称直辖市“史上最低落户门槛”。 不到一天吸引30万人申请，天津新政落户者一度引发无数关注。 "
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p8.mp3",
 						score: _this.p8Num,
 						"keyword": "严谨,坚持原则,追求正义",
 						"names": "王勇",
 						"shareword": "检察官王勇应该是你很喜欢的一类人，他的严谨、公正，在法、理、情天平之间精准度量的正义感打动你。你做人做事力求正直严谨，哪怕有时被说不懂变通也要坚持原则。",
 						desc: "2018轰动全国的827昆山反杀案里，检察官王勇带团队主动介入引导侦查。他将“什么是正当防卫”向人民群众清楚阐释，让司法与民意良性互动，层层剥茧、严丝合缝的说理，为大众重塑邪不压正的信心。"
 					}, {
 						music: "//mat1.gtimg.com/news/zt2018/jjhjh5/p9.mp3",
 						score: _this.p9Num,
 						"keyword": "温情,人道主义,善良",
 						"names": "5·12日本救援队",
 						"shareword": "像是5·12日本救援队对生命的敬意和尊重一样，你心有美好，愿意相信人性善良。偶尔有时你会被说有点犯傻，但是你的善良和不偏袒总能让更多人信服。",
 						desc: "5·12地震期间，日本救援队在中国展开了一场短暂且沉重的救援行动，返程比来时更沉默，救援人员对中国人说“没有救出一人，真的非常抱歉”。灾后十年，他们重返北川。"
 					}];
 					_this.flag = false;
 					setTimeout(function() {
 						_this.questNum++;
 						_this.flag = true;
 						if(_this.questNum >= questData.length) {
 							_this.waitPage()
 						} else {
 							$(".question-main").animate({
 								'left': -_this.questNum * _this._w
 							}, {
 								'duration': 500,
 								'complete': function() {
 									_this.toQuestPage()
 								}
 							})
 						}
 					}, 500)
 				}
 			})
 		})
 	},
 	drawLine: function(ctx, color, lineWidth, leftPos, begin, end) {
 		ctx.strokeStyle = color;
 		ctx.lineWidth = lineWidth;
 		ctx.beginPath();
 		ctx.moveTo(leftPos, begin);
 		ctx.lineTo(leftPos, end);
 		ctx.stroke();
 		ctx.closePath()
 	},
 	drawRoundedRect: function(ctx, start, end, h, color) {
 		ctx.beginPath();
 		ctx.moveTo(start, h);
 		ctx.lineTo(end, h);
 		ctx.closePath();
 		ctx.lineWidth = 40;
 		ctx.strokeStyle = color;
 		ctx.lineJoin = "round";
 		ctx.stroke()
 	},
 	writeTextCanvas: function(ctx, text, size, fillStyle, isBlods, startLeft, startTop) {
 		ctx.beginPath();
 		ctx.font = isBlods + " " + size + "px Arial";
 		ctx.fillStyle = fillStyle;
 		ctx.fillText(text, startLeft, startTop);
 		ctx.closePath();
 		ctx.stroke()
 	},
 	firstUpperCase: function(str) {
 		return str.charAt(0).toUpperCase() + str.substring(1, str.length)
 	},
 	writeTextCenter: function(ctx_2d, text, size, fillStyle, isBlods, canvasWidth, disW, startTop) {
 		ctx_2d.font = isBlods + " " + size + "px Arial";
 		ctx_2d.fillStyle = fillStyle;
 		var textWidth = ctx_2d.measureText(text).width;
 		ctx_2d.fillText(this.firstUpperCase(text), (canvasWidth + disW - textWidth) / 2, startTop);
 		ctx_2d.stroke()
 	},
 	convertImgToBase64: function(url, callback, outputFormat) {
 		var _this = this;
 		var canvas = document.createElement('canvas'),
 			ctx = canvas.getContext('2d'),
 			img = new Image;
 		canvas.height = _this._w * 0.86 * 2 * 0.23;
 		canvas.width = _this._w * 0.86 * 2 * 0.23;
 		img.crossOrigin = 'Anonymous';
 		img.onload = function() {
 			ctx.drawImage(img, 0, 0, img.width, img.height, 0, 0, canvas.width, canvas.height);
 			var dataURL = canvas.toDataURL(outputFormat || 'image/png');
 			callback.call(this, dataURL);
 			canvas = null
 		};
 		img.src = url
 	},
 	getTrueLength: function(str) {
 		var len = str.length,
 			truelen = 0;
 		for(var x = 0; x <
 			len; x++) {
 			if(str.charCodeAt(x) > 128) {
 				truelen += 2
 			} else {
 				truelen += 1
 			}
 		}
 		return truelen
 	},
 	cutString: function(str, leng) {
 		var len = str.length,
 			tlen = len,
 			nlen = 0;
 		for(var x = 0; x <
 			len; x++) {
 			if(str.charCodeAt(x) > 128) {
 				if(nlen + 2 <
 					leng) {
 					nlen += 2
 				} else {
 					tlen = x;
 					break
 				}
 			} else {
 				if(nlen + 1 < leng) {
 					nlen += 1
 				} else {
 					tlen = x;
 					break
 				}
 			}
 		}
 		return tlen
 	},
 	writeTextBreak: function(ctx_2d, lineheight, bytelength, text, startleft, starttop) {
 		for(var i = 1; this.getTrueLength(text) > 0; i++) {
 			var tl = this.cutString(text, bytelength);
 			ctx_2d.font = "25px Arial";
 			ctx_2d.fillStyle = '#ffffff';
 			ctx_2d.fillText(text.substring(0, tl).replace(/^\s+|\s+$/, ""), startleft, (i - 1) * lineheight + starttop);
 			ctx_2d.stroke();
 			text = text.substring(tl)
 		}
 	},
 	createCanvas: function() {
 		var _this = this;
 		$(".share-page").show();
 		new QRCode(document.getElementById("code"), {
 			text: 'http://news.qq.com/zt2018/jjhjh5/index.htm',
 			width: 200,
 			height: 200,
 			colorDark: "#000000",
 			colorLight: "#ffffff",
 			correctLevel: QRCode.CorrectLevel.L
 		});
 		var canvasW = this._w * .86;
 		var canvasH = this.getHeight((649 / 1079), 0.86);
 		$(".canvas-main").css({
 			'width': canvasW,
 			'height': canvasH,
 			'margin-left': -canvasW / 2,
 			'margin-top': -canvasH / 2
 		});
 		var canvas = document.getElementById('canvas');
 		var ctx = canvas.getContext('2d');
 		canvas.style.width = canvasW + 'px';
 		canvas.style.height = canvasH + 'px';
 		canvas.width = canvasW * 2;
 		canvas.height = canvasH * 2;
 		var canvasBg = new Image();
 		canvasBg.onload = function() {
 			ctx.drawImage(canvasBg, 0, 0, canvasBg.width, canvasBg.height, 0, 0, canvas.width, canvas.height);
 			var codeImg = new Image();
 			codeImg.onload = function() {
 				ctx.drawImage(codeImg, 0, 0, codeImg.width, codeImg.height, canvas.width - canvas.width * 0.178, canvas.height - canvas.height * 0.107, canvas.width * 0.17, canvas.height * 0.102);
 				_this.drawRoundedRect(ctx, 45, canvas.width * 0.7, canvas.height * 0.35, '#1d2a35');
 				_this.drawRoundedRect(ctx, 45, parseInt(_this.threePeople[0].score) / _this.resultNum * canvas.width * 0.7, canvas.height * 0.35, '#2cacc6');
 				_this.writeTextCanvas(ctx, _this.threePeople[0].names, 28, "#96989b", 'normal', 45, canvas.height * 0.35 + 51);
 				_this.writeTextCanvas(ctx, $(".pp-01").html(), 36, "#2cacc6", 'bold', canvas.width * 0.62, canvas.height * 0.35 + 55);
 				_this.drawRoundedRect(ctx, 45, canvas.width * 0.7, canvas.height * 0.45, '#1d2a35');
 				_this.drawRoundedRect(ctx, 45, parseInt(_this.threePeople[1].score) / _this.resultNum * canvas.width * 0.7, canvas.height * 0.45, '#6579ff');
 				_this.writeTextCanvas(ctx, _this.threePeople[1].names, 28, "#96989b", 'normal', 45, canvas.height * 0.45 + 51);
 				_this.writeTextCanvas(ctx, $(".pp-02").html(), 36, "#6579ff", 'bold', canvas.width * 0.62, canvas.height * 0.45 + 55);
 				_this.drawRoundedRect(ctx, 45, canvas.width * 0.7, canvas.height * 0.55, '#1d2a35');
 				_this.drawRoundedRect(ctx, 45, parseInt(_this.threePeople[2].score) / _this.resultNum * canvas.width * 0.7, canvas.height * 0.55, '#3058d8');
 				_this.writeTextCanvas(ctx, _this.threePeople[2].names, 28, "#96989b", 'normal', 45, canvas.height * 0.55 + 51);
 				_this.writeTextCanvas(ctx, $(".pp-03").html(), 36, "#3058d8", 'bold', canvas.width * 0.62, canvas.height * 0.55 + 55);
 				_this.drawLine(ctx, '#2abbd8', 5, 38, canvas.height * 0.657, canvas.height * 0.685);
 				_this.writeTextCanvas(ctx, _this.threePeople[0].names, 30, "#ffffff", 'bold', 50, canvas.height * 0.68);
 				_this.writeTextBreak(ctx, 35, canvas.width * 0.066, _this.threePeople[0].shareword, 50, canvas.height * 0.73);
 				_this.writeTextCenter(ctx, nickname, 36, '#ffffff', 'normal', canvas.width, canvas.width * 0.26, canvas.height * 0.13);
 				_this.convertImgToBase64(headimgurl, function(dataURL) {
 					var photo = new Image();
 					photo.onload = function() {
 						var pattern = ctx.createPattern(photo, "no-repeat");
 						ctx.lineWidth = 0;
 						ctx.strokeStyle = "#ffffff";
 						ctx.translate(canvas.width * 0.05, canvas.height * 0.075);
 						ctx.beginPath();
 						ctx.arc(photo.width / 2, photo.width / 2, photo.width / 2, 0, 2 * Math.PI);
 						ctx.stroke();
 						ctx.fillStyle = pattern;
 						ctx.fill();
 						$(".finale").show().html(Canvas2Image.convertToImage(canvas, canvasW * 2, canvasH * 2, 'png'))
 					};
 					photo.src = dataURL
 				})
 			};
 			codeImg.src = $("#code img").attr('src')
 		};
 		canvasBg.src = '//news.qq.com/zt2018/jjhjh5/canvasbg.jpg'
 	},
 	active: function() {
 		var _this = this;
 		setTimeout(function() {
 			$(".loading-btn").fadeIn(400)
 		}, 4000);
 		$(".loading-btn").enableTouch().on('tap', function() {
 			_this.toCoverPage()
 		});
 		$(".cover-btn").enableTouch().on('tap', function() {
 			_this.toQuestPage()
 		});
 		$(".name-main span").each(function(i) {
 			$(this).enableTouch().on('tap', function() {
 				var aSpan = $(".name-main span");
 				aSpan.removeClass('active').eq(i).addClass('active');
 				$(".word-list").animate({
 					'margin-left': -(i * _this._w * 0.88 + i * 10) + 'px'
 				});
 				$(".listen").removeClass('active');
 				$(".music_btn audio")[0].pause()
 			})
 		});
 		$(".word-main").enableTouch().on('swipeLeft', function() {
 			_this.wordNum++;
 			if(_this.wordNum >= $(".word-list li").length - 1) {
 				_this.wordNum = $(".word-list li").length - 1
 			}
 			$(".listen").removeClass('active');
 			$(".music_btn audio")[0].pause();
 			$(".name-main span").removeClass('active').eq(_this.wordNum).addClass('active');
 			$(".word-list").animate({
 				'margin-left': -(_this.wordNum * _this._w * 0.88 + 10 * _this.wordNum) + 'px'
 			})
 		}).on('swipeRight', function() {
 			_this.wordNum--;
 			if(_this.wordNum <=
 				0) {
 				_this.wordNum = 0
 			}
 			$(".listen").removeClass('active');
 			$(".music_btn audio")[0].pause();
 			$(".name-main span").removeClass('active').eq(_this.wordNum).addClass('active');
 			$(".word-list").animate({
 				'margin-left': -(_this.wordNum * _this._w * 0.88 + 10 * _this.wordNum) + 'px'
 			})
 		});
 		$(".friend-btn").enableTouch().on('tap', function() {
 			_this.createCanvas()
 		});
 		$(".closecanvas").enableTouch().on('tap', function() {
 			$(".share-page").fadeOut(400);
 			$(".finale").hide();
 			$("#code").html('')
 		});
 		$(".more-btn").enableTouch().on('tap', function() {
 			$(".words-page").fadeIn(400);
 			$(".words-main>div").eq(_this.classNum).addClass('rockDey');
 			clearInterval(_this.classTimer);
 			_this.classTimer = setInterval(function() {
 				_this.classNum++;
 				if(_this.classNum >= $(".words-main>div").length) {
 					_this.classNum = 0;
 					$(".words-main>div").eq($(".words-main>div").length - 1).removeClass('rockDey');
 					$(".words-main>div").eq(_this.classNum).addClass('rockDey')
 				} else {
 					$(".words-main>div").eq(_this.classNum - 1).removeClass('rockDey');
 					$(".words-main>div").eq(_this.classNum).addClass('rockDey')
 				}
 			}, 2500)
 		});
 		$(".words-main>div").each(function(i) {
 			$(this).enableTouch().on('tap', function() {
 				var src = $(".words-main>div").eq(i).attr('src');
 				$(".music_btn audio").attr('src', src);
 				$(".audio_btn audio")[0].pause();
 				if($(this).hasClass('active')) {
 					$(this).removeClass('active').addClass('off');
 					$(".music_btn audio")[0].pause()
 				} else {
 					$(this).removeClass('off').addClass('active');
 					$(".music_btn audio")[0].play()
 				}
 			})
 		});
 		$(".closeword").enableTouch().on('tap', function() {
 			$(".words-page").fadeOut(400);
 			$(".music_btn audio")[0].pause();
 			clearInterval(_this.classTimer);
 			_this.classNum = 0;
 			$(".words-main>div").removeClass('rockDey active')
 		});
 		$(".listen").each(function(i) {
 			$(this).enableTouch().on('tap', function() {
 				var src = $(".listen").eq(i).attr('src');
 				$(".music_btn audio").attr('src', src);
 				$(".audio_btn audio")[0].pause();
 				$(".listen").eq(i).removeClass('fadeAways');
 				if($(this).hasClass('active')) {
 					$(this).removeClass('active').addClass('off');
 					$(".music_btn audio")[0].pause()
 				} else {
 					$(this).removeClass('off').addClass('active');
 					$(".music_btn audio")[0].play();
 					$(".music_btn audio")[0].addEventListener('ended', function() {
 						$(".listen").eq(i).removeClass('active')
 					}, false)
 				}
 			})
 		});
 		$(".audio_btn").find('audio')[0].play();
 		$(".audio_btn").find('audio')[0].volume = 0.3;
 		document.addEventListener("WeixinJSBridgeReady", function() {
 			$(".audio_btn").find('audio')[0].play();
 			$(".audio_btn").find('audio')[0].volume = 0.3
 		}, false)
 	}
 };
 people.init();</script>
</html>